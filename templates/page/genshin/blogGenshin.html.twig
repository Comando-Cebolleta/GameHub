{% extends 'base.html.twig' %}

{% block title %}GameHub Blog Genshin Impact{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css"/>

    <link rel="stylesheet" href="{{ asset('css/styleBlogGENSHIN.css') }}">
{% endblock %}

{% block body %}

    {# Invocamos el header modular con GOLD #}
    {% include 'partials/header.html.twig' with {'iconColor': 'GOLD'} %}

    <main>
        <div class="container blog-wrapper">

            <div class="top-actions">
                <a href="{{ path('genshin_nuevo_post', {'juego': 'genshin'}) }}" title="Crear Post">
                    <img src="{{ asset('assets/img/postIconGOLD.webp') }}" alt="Crear Post" class="action-icon">
                </a>

                <a href="{{ path('app_build_genshin_create') }}" title="Crear Build">
                    <img src="{{ asset('assets/img/buildIconGOLD.webp') }}" alt="Crear Build" class="action-icon">
                </a>
            </div>

            {# --- CONTROLES DEL CARRUSEL --- #}
            <div class="carousel-header">
                <button class="carousel-btn btn-prev">&#10094;</button>
                <h1 id="carousel-title" class="carousel-title">Publicaciones</h1>
                <button class="carousel-btn btn-next">&#10095;</button>
            </div>

            {# --- CONTENEDOR SLICK --- #}
            <div class="mi-carrusel">

                {# ========================================== #}
                {# SECCIÓN 1: POSTS (Slide 0)                 #}
                {# ========================================== #}
                <div id="section-posts">
                    {% if posts is empty %}
                        <div style="text-align: center; padding: 50px; opacity: 0.7;">
                            <p>Todavía no hay publicaciones sobre Genshin Impact. ¡Sé el primero en subir contenido!</p>
                        </div>
                    {% else %}
                        {% for post in posts %}
                            <article class="post-card">
                                <div class="post-content">
                                    <a href="{{ path('genshin_post', {'id': post.id}) }}" class="post-link">
                                        <h2>{{ post.titulo }}</h2>
                                    </a>
                                    <p>
                                        {{ post.cuerpo|striptags|slice(0, 250) ~ '...' }}
                                    </p>
                                </div>

                                <div class="post-icons-area">
                                    <span class="icon-label">
                                        <a href="{{ path('app_profile', {'id': post.user.id}) }}">Autor: {{ post.user.username }}</a>
                                    </span>
                                    <span class="icon-label" style="font-size: 0.75rem; opacity: 0.6; margin-top: 5px;">
                                        {{ post.fechaPublicacion|date('d/m/Y') }}
                                    </span>
                                </div>
                            </article>

                            {% if not loop.last %}
                                <hr class="divider">
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                </div>

                {# ========================================== #}
                {# SECCIÓN 2: BUILDS (Slide 1)                #}
                {# ========================================== #}
                <div id="section-builds">
                    {% if builds is not defined or builds is empty %}
                        <div style="text-align: center; padding: 50px; opacity: 0.7;">
                            <p>Todavía no hay builds creadas. ¡Sé el primero en aportar una!</p>
                        </div>
                    {% else %}
                        {% for build in builds %}
                            <article class="post-card">
                                <div class="post-content">
                                    <a href="{{ path('app_build_view', {'id': build.id}) }}" class="post-link">
                                        <h2>Build: {{ build.personajePlantilla.nombre }}</h2>
                                    </a>
                                    <p>
                                        <strong>Personaje:</strong> {{ build.personajePlantilla.nombre }} <br>
                                        <strong>Nivel:</strong> {{ build.nivel }} | <strong>Arma:</strong> {{ build.arma.armaPlantilla.nombre|default('Ninguna') }}
                                    </p>
                                </div>

                                <div class="post-icons-area">
                                    <span class="icon-label">
                                        <a href="{{ path('app_profile', {'id': build.user.id}) }}">Autor: {{ build.user.username }}</a>
                                    </span>
                                </div>
                            </article>

                            {% if not loop.last %}
                                <hr class="divider">
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                </div>

            </div> {# FIN DEL CARRUSEL #}

        </div>
    </main>

    <footer>
        Game Hub &copy; 2025-2026
    </footer>

{% endblock %}

{# --- CARGAMOS EL JS EXTERNO AQUÍ --- #}
{% block javascripts %}
    {{ parent() }}
    {# El parent() trae los scripts generales de base.html.twig (como el menú o cosas globales) para no borrarlos al añadir los nuestros #}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
    <script src="{{ asset('js/sliderBlog.js') }}"></script>
{% endblock %}