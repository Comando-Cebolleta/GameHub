{% extends 'base.html.twig' %}

{% block title %}{{ post.titulo }}{% endblock %}

{% block stylesheets %}
    {% if juego == 'hsr' %}
        <link rel="stylesheet" href="{{ asset('css/styleBlogHONKAI.css') }}">
    {% else %}
        <link rel="stylesheet" href="{{ asset('css/styleBlogGENSHIN.css') }}">
    {% endif %}

    <link rel="stylesheet" href="{{ asset('css/styleSinglePost.css') }}">
    <link rel="stylesheet" href="{{ asset('css/styleLogin.css') }}">
{% endblock %}

{% block body %}
    {% include 'partials/header.html.twig' with {'iconColor': juego == 'hsr' ? 'SILVER' : 'GOLD'} %}

    <main>
        {# Le pasamos el tema como clase al contenedor #}
        <div class="container theme-{{ juego }}">
            <article class="post-reading">
                <h1 class="post-header-title">{{ post.titulo }}</h1>

                <div class="post-meta">
                    Escrito por <strong>
                        {% if post.user %}
                            {# ENLACE AL PERFIL DEL CREADOR DEL POST #}
                            <a href="{{ path('app_profile', {'id': post.user.id}) }}" style="color: inherit; text-decoration: none; border-bottom: 1px solid currentColor; transition: opacity 0.2s;" onmouseover="this.style.opacity='0.7'" onmouseout="this.style.opacity='1'">
                                {{ post.user.username }}
                            </a>
                        {% else %}
                            Anónimo
                        {% endif %}
                    </strong>
                    el <span>{{ post.fechaPublicacion ? post.fechaPublicacion|date('d/m/Y') : 'Fecha desconocida' }}</span>
                </div>

                <div class="post-full-content">
                    {{ post.cuerpo | sanitize_html('app.post_sanitizer') }}
                </div>

                <div class="back-container">
                    {% if juego == 'hsr' %}
                        <a href="{{ path('hsr_blog') }}" class="back-link">&larr; VOLVER AL BLOG HSR</a>
                    {% else %}
                        <a href="{{ path('genshin_blog') }}" class="back-link">&larr; VOLVER AL BLOG GENSHIN</a>
                    {% endif %}
                </div>

                <section class="comments-section">
                    <h2>Comentarios ({{ post.comentarios|length }})</h2>

                    <div class="comments-list">
                        {% for comentario in post.comentarios %}
                            <div class="comment">
                                <div class="comment-header">
                                    <strong>
                                        {% if comentario.user %}
                                            {# ENLACE AL PERFIL DEL CREADOR DEL COMENTARIO #}
                                            <a href="{{ path('app_profile', {'id': comentario.user.id}) }}" style="color: inherit; text-decoration: none; transition: opacity 0.2s;" onmouseover="this.style.opacity='0.7'" onmouseout="this.style.opacity='1'">
                                                &commat;{{ comentario.user.username }}
                                            </a>
                                        {% else %}
                                            Anónimo
                                        {% endif %}
                                    </strong>
                                    <span>{{ comentario.fechaPublicacion|date('d/m/Y H:i') }}</span>
                                </div>
                                <div class="comment-body">
                                    {{ comentario.cuerpo|nl2br }}
                                </div>
                            </div>
                        {% else %}
                            <p class="empty-comments">No hay comentarios todavía. ¡Sé el primero en comentar!</p>
                        {% endfor %}
                    </div>

                    {% if app.user %}
                        <div class="new-comment-form">
                            <h3>Deja un comentario</h3>
                            {{ form_start(commentForm) }}
                            <div class="form-group">
                                {{ form_widget(commentForm.cuerpo, {'attr': {'placeholder': 'Escribe tu comentario aquí...'}}) }}
                            </div>

                            {{ form_row(commentForm._token) }}

                            <button type="submit" class="btn-submit-comment">
                                Publicar Comentario
                            </button>

                            {{ form_end(commentForm, {'render_rest': false}) }}
                        </div>
                    {% else %}
                        <div class="login-prompt">
                            <p>Debes <a href="{{ path('app_login') }}">iniciar sesión</a> para dejar un comentario.</p>
                        </div>
                    {% endif %}
                </section>
            </article>
        </div>
    </main>

    <footer>
        Game Hub &copy; 2025-2026
    </footer>
{% endblock %}