{% extends 'base.html.twig' %}

{% block title %}Build{% endblock %}

{% block stylesheets %}
{% endblock %}

{% block body %}
    <div style="display: flex; flex-direction: column">
        {% if build is not null %}
            <h1>{{ build.getNombre() }}</h1>
            <img src="{{ asset('assets/personajes/' ~ build.getPersonajePlantilla().getImagen()) }}" alt="Imagen de la build" style="width: 300px; height: auto;">
            <p>Personaje: {{ build.getPersonajePlantilla().getNombre() }}</p>
            <p>Nivel: {{ build.getNivel() }}</p>
            <p>Dupes: {{ build.getDupeNum() }}</p>

            <table border="1" style="border-collapse: collapse; width: 100%; margin-top: 20px;">
                <tr>
                    <th style="border: 1px solid black;">Arma</th>
                    <th style="border: 1px solid black;">Nivel</th>
                    <th style="border: 1px solid black;">Imagen</th>
                    <th style="border: 1px solid black;">Estadísticas</th>
                    <th style="border: 1px solid black;">Pasiva</th>
                    <th style="border: 1px solid black;">Tipo</th>
                </tr>
                <tr>
                    <td style="border: 1px solid black;">{{ build.getArma().getArmaPlantilla().getNombre() }}</td>
                    <td style="border: 1px solid black;">{{ build.getArma().getNivel() }}</td>
                    <td style="border: 1px solid black;">
                        {% if build.getArma() %}
                            <img src="{{ asset('assets/armas/' ~ build.getArma().getArmaPlantilla().getImagen()) }}" alt="Imagen del arma" style="width: 100px; height: auto;">
                        {% else %}
                            Sin arma
                        {% endif %}
                    </td>
                    <td style="border: 1px solid black;">
                        <ul>
                            {% for nombreStat, valor in build.getArma().getStatsCalculados() %}
                                <li>
                                    <strong>{{ diccionarioStats[nombreStat] ?? nombreStat }}:</strong> {{ valor }}
                                </li>
                            {% endfor %}
                        </ul>
                    </td>
                    <td style="border: 1px solid black;">{{ build.getArma().getArmaPlantilla().getPasiva() }}</td>
                    <td style="border: 1px solid black;">{{ build.getArma().getArmaPlantilla().getTipo() }}</td>
                </tr>
            </table>
            
            <hr>

            <p>Estadísticas Totales de la Build:</p>
            <ul>
                {% for nombreStat, valor in build.getStatsCalculados() %}
                    <li>
                        <strong>{{ diccionarioStats[nombreStat] ?? nombreStat }}:</strong> {{ valor }}
                    </li>
                {% endfor %}
            </ul>

            <hr>

            <p>Artefactos:</p>
            <table border="1" style="border-collapse: collapse; width: 100%;">
                <tr>
                    <th style="border: 1px solid black;">Imagen</th>
                    <th style="border: 1px solid black;">Pieza</th>
                    <th style="border: 1px solid black;">Conjunto</th>
                    <th style="border: 1px solid black;">Estadísticas</th>
                    <th style="border: 1px solid black;">Bonificaciones de Conjunto</th>
                </tr>
                {% for artefacto in build.getArtefactos() %}
                    <tr>
                        <td style="border: 1px solid black;">
                            {% if artefacto %}
                                <img src="{{ asset('assets/artefactos/' ~ artefacto.getArtefactoPlantilla().getImagen()) }}" alt="Imagen del artefacto" style="width: 100px; height: auto;">
                            {% else %}
                                Sin artefacto
                            {% endif %}
                        </td>
                        <td style="border: 1px solid black;">{{ artefacto.getArtefactoPlantilla().getPiezaTipo().getNombre() }}</td>
                        <td style="border: 1px solid black;">{{ artefacto.getArtefactoPlantilla().getSetArtefactos().getNombre() }}</td>
                        <td style="border: 1px solid black;">
                            {% set stats = artefacto.getEstadisticas() %}
                            
                            <ul style="margin: 0; padding-left: 20px;">
                                {# 1. Renderizar Main Stat (si existe) #}
                                {% if stats.main_stat is defined %}
                                    <li style="font-weight: bold; color: #d35400;">
                                        {{ diccionarioStats[stats.main_stat.name] ?? stats.main_stat.name }}: {{ stats.main_stat.value }}
                                    </li>
                                {% endif %}

                                {# 2. Renderizar Sub Stats (si existen y es una lista) #}
                                {% if stats.sub_stats is defined %}
                                    {% for sub in stats.sub_stats %}
                                        <li>
                                            {{ diccionarioStats[sub.name] ?? sub.name }}: +{{ sub.value }}
                                        </li>
                                    {% endfor %}
                                {% endif %}
                            </ul>
                        </td>
                        <td style="border: 1px solid black;">{{ artefacto.getArtefactoPlantilla().getSetArtefactos().getEfectos() }}</td>
                    </tr>
                {% endfor %}
            </table>

            <p><a href="{{ path('app_profile', {'id': build.getUser().getId()}) }}">Creador: {{ build.getUser().getUsername() }}</a></p>

            <hr>

            <h3>Habilidades</h3>
            {% if build.getPersonajePlantilla().getHabilidades() is not empty %}
                <table border="1" style="border-collapse: collapse; width: 100%; margin-top: 20px;">
                    <tr>
                        <th style="border: 1px solid black;">Nombre</th>
                        <th style="border: 1px solid black;">Efectos</th>
                    </tr>
                    {% for habilidad in build.getPersonajePlantilla().getHabilidades() %}
                        <tr>
                            <td style="border: 1px solid black;">{{ habilidad.getNombre() }}</td>
                            <td style="border: 1px solid black;">{{ habilidad.getEfectos() }}</td>
                        </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p>No hay habilidades registradas para este personaje.</p>
            {% endif %}
        {% else %}
            <p>No se ha encontrado esa build.</p>
        {% endif %}
    </div>
{% endblock %}